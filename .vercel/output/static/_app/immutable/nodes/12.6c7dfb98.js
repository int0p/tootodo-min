import{f as ne}from"../chunks/fetch-refresh.dd216df5.js";import{e as ie}from"../chunks/index.5e2a9a64.js";import{S as ae,i as oe,s as re,a as K,b as A,h as M,q as O,B as fe,R as ue,z as v,w as b,x as V,E as Q,N as ce,O as me,P as pe,Q as _e,d as R,j as T,p as k,l as $,K as $e,e as E,J as Z,f as S,g as N,m as y,v as B,y as C,t as F,k as q,r as w,A as J,G as de,a8 as he,T as ge,I as ve,M as we}from"../chunks/index.62fc0439.js";import{a as W,e as be}from"../chunks/forms.12d2b5b9.js";import{i as X}from"../chunks/navigation.a1d25632.js";import{p as ke}from"../chunks/stores.4d5e9aa8.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.fe36e70c.js";import"../chunks/Modal.svelte_svelte_type_style_lang.10e906d4.js";import{I as ye}from"../chunks/Icon.6e62ecb4.js";import"../chunks/moment.a354566a.js";import{B as U}from"../chunks/Button.78294429.js";import{I as Pe}from"../chunks/ItemPage.49193770.js";import{T as Ee}from"../chunks/Player.d3fd5d62.js";import{t as Y}from"../chunks/toasts.ae3a6e2f.js";import{P as Se}from"../chunks/PlaylistForm.ef96aaa6.js";import{M as Ne}from"../chunks/Modal.de47eda4.js";import{l as x}from"../chunks/micromodal.es.946cf5e2.js";function Fe(o){let e;const t=o[2].default,l=ce(t,o,o[3],null);return{c(){l&&l.c()},l(a){l&&l.l(a)},m(a,s){l&&l.m(a,s),e=!0},p(a,s){l&&l.p&&(!e||s&8)&&me(l,t,a,a[3],e?_e(t,a[3],s,null):pe(a[3]),null)},i(a){e||(v(l,a),e=!0)},o(a){b(l,a),e=!1},d(a){l&&l.d(a)}}}function qe(o){let e,t;const l=[{name:"heart"},o[1],{iconNode:o[0]}];let a={$$slots:{default:[Fe]},$$scope:{ctx:o}};for(let s=0;s<l.length;s+=1)a=K(a,l[s]);return e=new ye({props:a}),{c(){A(e.$$.fragment)},l(s){M(e.$$.fragment,s)},m(s,n){O(e,s,n),t=!0},p(s,[n]){const c=n&3?fe(l,[l[0],n&2&&ue(s[1]),n&1&&{iconNode:s[0]}]):{};n&8&&(c.$$scope={dirty:n,ctx:s}),e.$set(c)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){b(e.$$.fragment,s),t=!1},d(s){V(e,s)}}}function Ie(o,e,t){let{$$slots:l={},$$scope:a}=e;const s=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"}]];return o.$$set=n=>{t(1,e=K(K({},e),Q(n))),"$$scope"in n&&t(3,a=n.$$scope)},e=Q(e),[s,e,l,a]}class Le extends ae{constructor(e){super(),oe(this,e,Ie,qe,re,{})}}const Re=Le,Te=async({fetch:o,params:e,depends:t,route:l,url:a,parent:s})=>{t(`app:${l.id}`);const{user:n}=await s(),c=_=>ne(o,_),[d,u]=await Promise.all([c(`/spotify/api/spotify/playlists/${e.id}`),c(`/spotify/api/spotify/playlists/${e.id}/followers/contains?${new URLSearchParams({ids:n?n.id:""}).toString()}`)]);if(!d.ok)throw ie(d.status,"Failed to load playlist!");let r=null;u.ok&&(r=(await u.json())[0]);const i=await d.json();let m=null;if(i.images.length>0){const _=await c(`../api/average-color?${new URLSearchParams({image:i.images[0].url}).toString()}`);_.ok&&(m=(await _.json()).color)}return{playlist:i,color:m,title:i.name,isFollowing:r}},pt=Object.freeze(Object.defineProperty({__proto__:null,load:Te},Symbol.toStringTag,{value:"Module"}));function Ae(o){var i;let e,t,l,a,s,n,c,d,u={element:"button",type:"submit",variant:"outline",disabled:o[6],$$slots:{default:[Oe]},$$scope:{ctx:o}};t=new U({props:u}),o[15](t);let r=o[1]&&"followForm"in o[1]&&((i=o[1])==null?void 0:i.followError)&&ee(o);return{c(){e=E("form"),A(t.$$.fragment),l=R(),r&&r.c(),this.h()},l(m){e=S(m,"FORM",{class:!0,method:!0,action:!0});var _=N(e);M(t.$$.fragment,_),l=T(_),r&&r.l(_),_.forEach($),this.h()},h(){y(e,"class","follow-form svelte-1q4ivft"),y(e,"method","POST"),y(e,"action",a=`?/${o[9]?"unFollowPlaylist":"followPlaylist"}`)},m(m,_){k(m,e,_),O(t,e,null),w(e,l),r&&r.m(e,null),n=!0,c||(d=ge(s=be.call(null,e,o[16])),c=!0)},p(m,_){var f;const p={};_&64&&(p.disabled=m[6]),_&525824&&(p.$$scope={dirty:_,ctx:m}),t.$set(p),m[1]&&"followForm"in m[1]&&((f=m[1])!=null&&f.followError)?r?r.p(m,_):(r=ee(m),r.c(),r.m(e,null)):r&&(r.d(1),r=null),(!n||_&512&&a!==(a=`?/${m[9]?"unFollowPlaylist":"followPlaylist"}`))&&y(e,"action",a),s&&ve(s.update)&&_&704&&s.update.call(null,m[16])},i(m){n||(v(t.$$.fragment,m),n=!0)},o(m){b(t.$$.fragment,m),n=!1},d(m){m&&$(e),o[15](null),V(t),r&&r.d(),c=!1,d()}}}function Me(o){let e,t;return e=new U({props:{element:"a",variant:"outline",href:"/spotify/playlist/"+o[10].id+"/edit",$$slots:{default:[Ve]},$$scope:{ctx:o}}}),e.$on("click",o[14]),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){O(e,l,a),t=!0},p(l,a){const s={};a&1024&&(s.href="/spotify/playlist/"+l[10].id+"/edit"),a&524288&&(s.$$scope={dirty:a,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){b(e.$$.fragment,l),t=!1},d(l){V(e,l)}}}function Oe(o){let e,t,l=o[9]?"Unfollow":"Follow",a,s,n,c=o[10].name+"",d,u,r;return e=new Re({props:{"aria-hidden":!0,focusable:"false",fill:o[9]?"var(--text-color)":"none"}}),{c(){A(e.$$.fragment),t=R(),a=F(l),s=R(),n=E("span"),d=F(c),u=F(" playlist"),this.h()},l(i){M(e.$$.fragment,i),t=T(i),a=q(i,l),s=T(i),n=S(i,"SPAN",{class:!0});var m=N(n);d=q(m,c),u=q(m," playlist"),m.forEach($),this.h()},h(){y(n,"class","visually-hidden")},m(i,m){O(e,i,m),k(i,t,m),k(i,a,m),k(i,s,m),k(i,n,m),w(n,d),w(n,u),r=!0},p(i,m){const _={};m&512&&(_.fill=i[9]?"var(--text-color)":"none"),e.$set(_),(!r||m&512)&&l!==(l=i[9]?"Unfollow":"Follow")&&J(a,l),(!r||m&1024)&&c!==(c=i[10].name+"")&&J(d,c)},i(i){r||(v(e.$$.fragment,i),r=!0)},o(i){b(e.$$.fragment,i),r=!1},d(i){V(e,i),i&&$(t),i&&$(a),i&&$(s),i&&$(n)}}}function ee(o){let e,t=o[1].followError+"",l;return{c(){e=E("p"),l=F(t),this.h()},l(a){e=S(a,"P",{class:!0});var s=N(e);l=q(s,t),s.forEach($),this.h()},h(){y(e,"class","error svelte-1q4ivft")},m(a,s){k(a,e,s),w(e,l)},p(a,s){s&2&&t!==(t=a[1].followError+"")&&J(l,t)},d(a){a&&$(e)}}}function Ve(o){let e;return{c(){e=F("Edit Playlist")},l(t){e=q(t,"Edit Playlist")},m(t,l){k(t,e,l)},d(t){t&&$(e)}}}function je(o){let e,t,l,a,s,n,c,d;return s=new U({props:{element:"a",href:"/search",$$slots:{default:[Ue]},$$scope:{ctx:o}}}),c=new U({props:{element:"a",href:"/playlists",$$slots:{default:[Je]},$$scope:{ctx:o}}}),{c(){e=E("div"),t=E("p"),l=F("No items added to this playlist yet."),a=R(),A(s.$$.fragment),n=R(),A(c.$$.fragment),this.h()},l(u){e=S(u,"DIV",{class:!0});var r=N(e);t=S(r,"P",{class:!0});var i=N(t);l=q(i,"No items added to this playlist yet."),i.forEach($),a=T(r),M(s.$$.fragment,r),n=T(r),M(c.$$.fragment,r),r.forEach($),this.h()},h(){y(t,"class","svelte-1q4ivft"),y(e,"class","empty-playlist svelte-1q4ivft")},m(u,r){k(u,e,r),w(e,t),w(t,l),w(e,a),O(s,e,null),w(e,n),O(c,e,null),d=!0},p(u,r){const i={};r&524288&&(i.$$scope={dirty:r,ctx:u}),s.$set(i);const m={};r&524288&&(m.$$scope={dirty:r,ctx:u}),c.$set(m)},i(u){d||(v(s.$$.fragment,u),v(c.$$.fragment,u),d=!0)},o(u){b(s.$$.fragment,u),b(c.$$.fragment,u),d=!1},d(u){u&&$(e),V(s),V(c)}}}function De(o){var m,_;let e,t,l,a,s,n,c,d;e=new Ee({props:{tracks:o[2],isOwner:((m=o[0].user)==null?void 0:m.id)===o[10].owner.id,userPlaylists:(_=o[0].userAllPlaylists)==null?void 0:_.filter(o[17])}});let u=o[3].next&&te(o),r=o[3].previous&&le(o),i=o[3].next&&se(o);return{c(){A(e.$$.fragment),t=R(),u&&u.c(),l=R(),a=E("div"),s=E("div"),r&&r.c(),n=R(),c=E("div"),i&&i.c(),this.h()},l(p){M(e.$$.fragment,p),t=T(p),u&&u.l(p),l=T(p),a=S(p,"DIV",{class:!0});var f=N(a);s=S(f,"DIV",{class:!0});var g=N(s);r&&r.l(g),g.forEach($),n=T(f),c=S(f,"DIV",{class:!0});var P=N(c);i&&i.l(P),P.forEach($),f.forEach($),this.h()},h(){y(s,"class","previous"),y(c,"class","next"),y(a,"class","pagination svelte-1q4ivft")},m(p,f){O(e,p,f),k(p,t,f),u&&u.m(p,f),k(p,l,f),k(p,a,f),w(a,s),r&&r.m(s,null),w(a,n),w(a,c),i&&i.m(c,null),d=!0},p(p,f){var P,j;const g={};f&4&&(g.tracks=p[2]),f&1025&&(g.isOwner=((P=p[0].user)==null?void 0:P.id)===p[10].owner.id),f&1&&(g.userPlaylists=(j=p[0].userAllPlaylists)==null?void 0:j.filter(p[17])),e.$set(g),p[3].next?u?(u.p(p,f),f&8&&v(u,1)):(u=te(p),u.c(),v(u,1),u.m(l.parentNode,l)):u&&(B(),b(u,1,1,()=>{u=null}),C()),p[3].previous?r?(r.p(p,f),f&8&&v(r,1)):(r=le(p),r.c(),v(r,1),r.m(s,null)):r&&(B(),b(r,1,1,()=>{r=null}),C()),p[3].next?i?(i.p(p,f),f&8&&v(i,1)):(i=se(p),i.c(),v(i,1),i.m(c,null)):i&&(B(),b(i,1,1,()=>{i=null}),C())},i(p){d||(v(e.$$.fragment,p),v(u),v(r),v(i),d=!0)},o(p){b(e.$$.fragment,p),b(u),b(r),b(i),d=!1},d(p){V(e,p),p&&$(t),u&&u.d(p),p&&$(l),p&&$(a),r&&r.d(),i&&i.d()}}}function Ue(o){let e;return{c(){e=F("Search for Content")},l(t){e=q(t,"Search for Content")},m(t,l){k(t,e,l)},d(t){t&&$(e)}}}function Je(o){let e;return{c(){e=F("View all Playlists")},l(t){e=q(t,"View all Playlists")},m(t,l){k(t,e,l)},d(t){t&&$(e)}}}function te(o){let e,t,l;return t=new U({props:{element:"button",variant:"outline",disabled:o[5],$$slots:{default:[Be]},$$scope:{ctx:o}}}),t.$on("click",o[13]),{c(){e=E("div"),A(t.$$.fragment),this.h()},l(a){e=S(a,"DIV",{class:!0});var s=N(e);M(t.$$.fragment,s),s.forEach($),this.h()},h(){y(e,"class","load-more svelte-1q4ivft")},m(a,s){k(a,e,s),O(t,e,null),l=!0},p(a,s){const n={};s&32&&(n.disabled=a[5]),s&524288&&(n.$$scope={dirty:s,ctx:a}),t.$set(n)},i(a){l||(v(t.$$.fragment,a),l=!0)},o(a){b(t.$$.fragment,a),l=!1},d(a){a&&$(e),V(t)}}}function Be(o){let e,t,l;return{c(){e=F("Load More "),t=E("span"),l=F("Tracks"),this.h()},l(a){e=q(a,"Load More "),t=S(a,"SPAN",{class:!0});var s=N(t);l=q(s,"Tracks"),s.forEach($),this.h()},h(){y(t,"class","visually-hidden")},m(a,s){k(a,e,s),k(a,t,s),w(t,l)},p:we,d(a){a&&$(e),a&&$(t)}}}function le(o){let e,t;return e=new U({props:{variant:"outline",element:"a",href:o[4].url.pathname+"?"+new URLSearchParams({page:`${Number(o[8])-1}`}).toString(),$$slots:{default:[Ce]},$$scope:{ctx:o}}}),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){O(e,l,a),t=!0},p(l,a){const s={};a&272&&(s.href=l[4].url.pathname+"?"+new URLSearchParams({page:`${Number(l[8])-1}`}).toString()),a&524288&&(s.$$scope={dirty:a,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){b(e.$$.fragment,l),t=!1},d(l){V(e,l)}}}function Ce(o){let e;return{c(){e=F("← Previous Page")},l(t){e=q(t,"← Previous Page")},m(t,l){k(t,e,l)},d(t){t&&$(e)}}}function se(o){let e,t;return e=new U({props:{variant:"outline",element:"a",href:o[4].url.pathname+"?"+new URLSearchParams({page:`${Number(o[8])+1}`}).toString(),$$slots:{default:[He]},$$scope:{ctx:o}}}),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){O(e,l,a),t=!0},p(l,a){const s={};a&272&&(s.href=l[4].url.pathname+"?"+new URLSearchParams({page:`${Number(l[8])+1}`}).toString()),a&524288&&(s.$$scope={dirty:a,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){b(e.$$.fragment,l),t=!1},d(l){V(e,l)}}}function He(o){let e;return{c(){e=F("Next Page →")},l(t){e=q(t,"Next Page →")},m(t,l){k(t,e,l)},d(t){t&&$(e)}}}function ze(o){let e,t,l,a,s,n,c,d;const u=[Me,Ae],r=[];function i(f,g){var P;return((P=f[0].user)==null?void 0:P.id)===f[10].owner.id?0:f[9]!==null?1:-1}~(t=i(o))&&(l=r[t]=u[t](o));const m=[De,je],_=[];function p(f,g){return f[10].tracks.items.length>0?0:1}return s=p(o),n=_[s]=m[s](o),{c(){e=E("div"),l&&l.c(),a=R(),n.c(),c=Z(),this.h()},l(f){e=S(f,"DIV",{class:!0});var g=N(e);l&&l.l(g),g.forEach($),a=T(f),n.l(f),c=Z(),this.h()},h(){y(e,"class","playlist-actions svelte-1q4ivft")},m(f,g){k(f,e,g),~t&&r[t].m(e,null),k(f,a,g),_[s].m(f,g),k(f,c,g),d=!0},p(f,g){let P=t;t=i(f),t===P?~t&&r[t].p(f,g):(l&&(B(),b(r[P],1,1,()=>{r[P]=null}),C()),~t?(l=r[t],l?l.p(f,g):(l=r[t]=u[t](f),l.c()),v(l,1),l.m(e,null)):l=null);let j=s;s=p(f),s===j?_[s].p(f,g):(B(),b(_[j],1,1,()=>{_[j]=null}),C(),n=_[s],n?n.p(f,g):(n=_[s]=m[s](f),n.c()),v(n,1),n.m(c.parentNode,c))},i(f){d||(v(l),v(n),d=!0)},o(f){b(l),b(n),d=!1},d(f){f&&$(e),~t&&r[t].d(),f&&$(a),_[s].d(f),f&&$(c)}}}function Ge(o){let e,t,l=o[10].description+"",a,s,n,c=o[10].owner.display_name+"",d,u,r,i=o[12].format(o[10].followers.total)+"",m,_,p,f,g=o[10].tracks.total+"",P,j;return{c(){e=E("div"),t=E("p"),a=R(),s=E("p"),n=E("span"),d=F(c),u=R(),r=E("span"),m=F(i),_=F(" Followers"),p=R(),f=E("span"),P=F(g),j=F(" Tracks"),this.h()},l(I){e=S(I,"DIV",{slot:!0});var L=N(e);t=S(L,"P",{class:!0});var H=N(t);H.forEach($),a=T(L),s=S(L,"P",{class:!0});var h=N(s);n=S(h,"SPAN",{class:!0});var D=N(n);d=q(D,c),D.forEach($),u=T(h),r=S(h,"SPAN",{class:!0});var z=N(r);m=q(z,i),_=q(z," Followers"),z.forEach($),p=T(h),f=S(h,"SPAN",{class:!0});var G=N(f);P=q(G,g),j=q(G," Tracks"),G.forEach($),h.forEach($),L.forEach($),this.h()},h(){y(t,"class","playlist-description svelte-1q4ivft"),y(n,"class","svelte-1q4ivft"),y(r,"class","svelte-1q4ivft"),y(f,"class","svelte-1q4ivft"),y(s,"class","meta svelte-1q4ivft"),y(e,"slot","meta")},m(I,L){k(I,e,L),w(e,t),t.innerHTML=l,w(e,a),w(e,s),w(s,n),w(n,d),w(s,u),w(s,r),w(r,m),w(r,_),w(s,p),w(s,f),w(f,P),w(f,j)},p(I,L){L&1024&&l!==(l=I[10].description+"")&&(t.innerHTML=l),L&1024&&c!==(c=I[10].owner.display_name+"")&&J(d,c),L&1024&&i!==(i=I[12].format(I[10].followers.total)+"")&&J(m,i),L&1024&&g!==(g=I[10].tracks.total+"")&&J(P,g)},d(I){I&&$(e)}}}function Ke(o){let e,t;return e=new Se({props:{action:"/spotify/playlist/"+o[10].id+"/edit",playlist:o[10],form:o[1]&&"editForm"in o[1]?o[1]:null}}),e.$on("success",o[18]),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){O(e,l,a),t=!0},p(l,a){const s={};a&1024&&(s.action="/spotify/playlist/"+l[10].id+"/edit"),a&1024&&(s.playlist=l[10]),a&2&&(s.form=l[1]&&"editForm"in l[1]?l[1]:null),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){b(e.$$.fragment,l),t=!1},d(l){V(e,l)}}}function Qe(o){let e,t,l,a;return e=new Pe({props:{title:o[10].name,image:o[10].images.length>0?o[10].images[0].url:void 0,color:o[11],type:o[10].type,$$slots:{meta:[Ge],default:[ze]},$$scope:{ctx:o}}}),l=new Ne({props:{id:"edit-playlist-modal",title:"Edit "+o[10].name,$$slots:{default:[Ke]},$$scope:{ctx:o}}}),{c(){A(e.$$.fragment),t=R(),A(l.$$.fragment)},l(s){M(e.$$.fragment,s),t=T(s),M(l.$$.fragment,s)},m(s,n){O(e,s,n),k(s,t,n),O(l,s,n),a=!0},p(s,[n]){const c={};n&1024&&(c.title=s[10].name),n&1024&&(c.image=s[10].images.length>0?s[10].images[0].url:void 0),n&2048&&(c.color=s[11]),n&1024&&(c.type=s[10].type),n&526335&&(c.$$scope={dirty:n,ctx:s}),e.$set(c);const d={};n&1024&&(d.title="Edit "+s[10].name),n&525314&&(d.$$scope={dirty:n,ctx:s}),l.$set(d)},i(s){a||(v(e.$$.fragment,s),v(l.$$.fragment,s),a=!0)},o(s){b(e.$$.fragment,s),b(l.$$.fragment,s),a=!1},d(s){V(e,s),s&&$(t),V(l,s)}}}function Ze(o,e,t){let l,a,s,n,c,d;$e(o,ke,h=>t(4,d=h));let{data:u}=e,{form:r}=e,i=!1,m=!1,_,p;const f=Intl.NumberFormat("en",{notation:"compact"}),g=async()=>{if(!s.next)return;t(5,i=!0);const h=await fetch(s.next.replace("https://api.spotify.com/v1/","/api/spotify/")),D=await h.json();h.ok?t(3,s={...D,items:[...s.items,...D.items]}):Y.error(D.error.message||"Could not load data!"),t(5,i=!1)},P=h=>{h.preventDefault(),x.show("edit-playlist-modal")};function j(h){de[h?"unshift":"push"](()=>{_=h,t(7,_)})}const I=()=>(t(6,m=!0),async({result:h})=>{var D;t(6,m=!1),h.type==="success"?(await W(h),t(9,n=!n)):h.type==="failure"?(Y.error((D=h.data)==null?void 0:D.followError),await he()):await W(h),_.focus(),X()}),L=h=>{var D;return h.owner.id===((D=u.user)==null?void 0:D.id)},H=()=>{x.close("edit-playlist-modal"),X()};return o.$$set=h=>{"data"in h&&t(0,u=h.data),"form"in h&&t(1,r=h.form)},o.$$.update=()=>{o.$$.dirty&1&&t(11,l=u.color),o.$$.dirty&1&&t(10,a=u.playlist),o.$$.dirty&1&&t(3,s=u.playlist.tracks),o.$$.dirty&1&&t(9,n=u.isFollowing),o.$$.dirty&16&&t(8,c=d.url.searchParams.get("page")||1),o.$$.dirty&12&&(t(2,p=[]),s.items.forEach(h=>{h.track&&t(2,p=[...p,h.track])}))},[u,r,p,s,d,i,m,_,c,n,a,l,f,g,P,j,I,L,H]}class _t extends ae{constructor(e){super(),oe(this,e,Ze,Qe,re,{data:0,form:1})}}export{_t as component,pt as universal};
