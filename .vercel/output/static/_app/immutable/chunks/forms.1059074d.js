import{p as h}from"./parse.bee59afc.js";import{c as E}from"./singletons.cf17b3b9.js";import{i as A}from"./navigation.afdaed4a.js";function w(t){return E.apply_action(t)}function L(t){const o=JSON.parse(t);return o.data&&(o.data=h(o.data)),o}function T(t){return HTMLElement.prototype.cloneNode.call(t)}function M(t,o=()=>{}){const c=async({action:e,result:r,reset:n})=>{r.type==="success"&&(n!==!1&&HTMLFormElement.prototype.reset.call(t),await A()),(location.origin+location.pathname===e.origin+e.pathname||r.type==="redirect"||r.type==="error")&&w(r)};async function s(e){var m,f,d,b,y;e.preventDefault();const r=new URL((m=e.submitter)!=null&&m.hasAttribute("formaction")?e.submitter.formAction:T(t).action),n=new FormData(t),l=(f=e.submitter)==null?void 0:f.getAttribute("name");l&&n.append(l,(b=(d=e.submitter)==null?void 0:d.getAttribute("value"))!=null?b:"");const u=new AbortController;let p=!1;const g=(y=await o({action:r,cancel:()=>p=!0,controller:u,get data(){return n},formData:n,get form(){return t},formElement:t,submitter:e.submitter}))!=null?y:c;if(p)return;let i;try{const a=await fetch(r,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:n,signal:u.signal});i=L(await a.text()),i.type==="error"&&(i.status=a.status)}catch(a){if((a==null?void 0:a.name)==="AbortError")return;i={type:"error",error:a}}g({action:r,get data(){return n},formData:n,get form(){return t},formElement:t,update:a=>c({action:r,result:i,reset:a==null?void 0:a.reset}),result:i})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",s),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",s)}}}export{w as a,M as e};
